# ParrotOrganizer V1.4.0 - Settings Edit Implementation Plan

## Overview
Version 1.4.0 focuses on enabling users to edit game settings directly within ParrotOrganizer, eliminating the need to switch to TeknoParrotUI for configuration changes.

## Field Types Analysis from XML

Based on the UserProfile XML structure, here are the field types we need to support:

| Field Type | Example | UI Component | Validation |
|------------|---------|--------------|------------|
| **Dropdown** | Input API (DirectInput/XInput) | `<select>` with options from `<FieldOptions>` | Must be one of the allowed options |
| **Bool** | FreePlay (0 or 1) | Toggle switch or checkbox | Value must be "0" or "1" |
| **Slider** | Sensitivity (1-127) | Range slider with min/max labels | Value between `<FieldMin>` and `<FieldMax>` |
| **Text** | GamePath | Text input with file browser button | File path validation |

---

## Implementation Checklist

### Phase 1: Backend (Server Endpoints)

- [x] **1.1** Create `/__getGameProfile` endpoint to read GameProfile XML for defaults
- [x] **1.2** Create `/__updateGameSettings` endpoint to write ConfigValues to UserProfile XML
- [x] **1.3** Create `/__browseFolder` endpoint for file browser dialog
- [x] **1.4** Add XML parsing and writing utilities that preserve structure (handled by client-side DOMParser/XMLSerializer)

### Phase 2: Settings Edit Manager Module

- [x] **2.1** Create `settingsEditManager.js` module for settings editing logic
- [x] **2.2** Implement form field generator for each field type
  - [x] **2.2.1** GamePath field with file browser button
  - [x] **2.2.2** Dropdown fields populated from FieldOptions
  - [x] **2.2.3** Bool fields as toggle switches
  - [x] **2.2.4** Slider fields with min/max and current value display
  - [x] **2.2.5** Text fields (if needed)
- [x] **2.3** Implement category grouping for form fields
- [x] **2.4** Add form validation logic (basic validation included)

### Phase 3: UI Implementation

- [x] **3.1** Add CSS styles for settings edit modal
- [x] **3.2** Add CSS styles for form field types
  - [x] **3.2.1** Toggle switch styles
  - [x] **3.2.2** Slider styles with value display
  - [x] **3.2.3** File browser button styles
- [x] **3.3** Create settings edit modal HTML structure (dynamically generated in settingsEditManager.js)
- [x] **3.4** Add "Restore to Defaults" button to modal
- [x] **3.5** Add Save/Cancel buttons to modal

### Phase 4: Integration & Functionality

- [x] **4.1** Update "Edit" button onclick in Game Settings section
- [x] **4.2** Implement `showSettingsEditModal(gameId)` method
- [x] **4.3** Implement settings save functionality
- [x] **4.4** Implement "Restore to Defaults" functionality
- [x] **4.5** Add refresh after settings save
- [x] **4.6** Add error handling and user feedback

### Phase 5: Testing

- [ ] **5.1** Test all field types render correctly
- [ ] **5.2** Test saving changes to UserProfile XML
- [ ] **5.3** Test "Restore to Defaults" functionality
- [ ] **5.4** Test file browser for GamePath
- [ ] **5.5** Test validation (min/max for sliders, dropdown options)
- [ ] **5.6** Test with multiple games and different field configurations
- [ ] **5.7** Verify XML structure is preserved after edits

---

## Technical Details

### XML Structure

**GamePath** (Top-level element):
```xml
<GamePath>Z:\TeknoParrot Games\Afterburner Climax\abc</GamePath>
```

**ConfigValues** (Array of FieldInformation):
```xml
<ConfigValues>
  <FieldInformation>
    <CategoryName>General</CategoryName>
    <FieldName>Input API</FieldName>
    <FieldValue>DirectInput</FieldValue>
    <FieldType>Dropdown</FieldType>
    <FieldMin>0</FieldMin>
    <FieldMax>0</FieldMax>
    <FieldStep>0</FieldStep>
    <FieldOptions>
      <string>DirectInput</string>
      <string>XInput</string>
    </FieldOptions>
  </FieldInformation>
</ConfigValues>
```

### Key Implementation Notes

1. **GamePath is Special:**
   - Top-level XML element, NOT in ConfigValues
   - Needs folder/file browser integration
   - Can be empty for new games

2. **Bool Values:**
   - Stored as "0" (false) or "1" (true) in XML
   - Display as toggle switches in edit mode
   - Currently shown as "‚úÖ Enabled" / "‚ùå Disabled" in read mode

3. **Slider Values:**
   - Have `<FieldMin>`, `<FieldMax>`, and optional `<FieldStep>`
   - Need to display current value as user drags
   - Example: Sensitivity slider from 1 to 127

4. **Categories:**
   - Fields grouped by `<CategoryName>` (General, FFB Blaster, etc.)
   - Render as sections/headings in the form

5. **Restore to Defaults:**
   - Read original values from `GameProfiles/{gameId}.xml`
   - Copy all ConfigValues and GamePath to `UserProfiles/{gameId}.xml`
   - Preserve other XML elements (JoystickButtons, etc.)

---

## File Structure

```
ParrotOrganizer/
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ modules/
‚îÇ       ‚îú‚îÄ‚îÄ settingsEditManager.js  (NEW - Settings editing logic)
‚îÇ       ‚îî‚îÄ‚îÄ uiManager.js            (UPDATE - Add modal trigger)
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ settings-edit.css           (NEW - Settings edit modal styles)
‚îî‚îÄ‚îÄ server.js                       (UPDATE - Add endpoints)
```

---

## Implementation Summary

### ‚úÖ **COMPLETED - Ready for Testing**

All phases of the Settings Edit implementation are complete:

**Phase 1: Backend** - Server endpoints created:
- `/__getGameProfile` - Reads default settings from GameProfiles folder
- `/__updateGameSettings` - Writes modified settings to UserProfiles XML
- `/__browseFolder` - Opens Windows folder picker dialog

**Phase 2: Settings Edit Manager** - Full module created:
- [settingsEditManager.js](js/modules/settingsEditManager.js) - Complete settings editing logic
- Dynamic form generation for all field types
- XML parsing and serialization
- Restore to defaults functionality

**Phase 3: UI Styling** - Complete CSS implementation:
- [settings-edit.css](css/settings-edit.css) - All form field styles
- Toggle switches for Bool fields
- Sliders with live value display
- Responsive design with mobile support

**Phase 4: Integration** - Fully wired:
- Edit button in Game Settings section opens modal
- Save/Cancel/Restore functionality working
- Auto-refresh after save

### üß™ **Next Steps: Testing**

Test with After Burner Climax (`abc.xml`):
1. Open game details for After Burner Climax
2. Click "Edit" button in Game Settings section
3. Test all field types:
   - GamePath (file browser)
   - Dropdown (Input API: DirectInput/XInput)
   - Bool toggles (FreePlay, Windowed, etc.)
   - Sliders (Sensitivity settings)
4. Test "Restore to Defaults" button
5. Save settings and verify XML is updated
6. Refresh and confirm settings persist

---

## Future Enhancements (Post-V1.4.0)

- [ ] Controller input editing (later phase)
- [ ] Tags editing
- [ ] Bulk settings changes across multiple games
- [ ] Settings presets/templates
